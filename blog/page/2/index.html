
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>yoshiori.github.io</title>
  <meta name="author" content="Yoshiori SHOJI">

  
  <meta name="description" content="「単純ベイズ分類器」を簡単に組み込める gem を作ってみました！！ BabyFace https://github.com/yoshiori/baby_face 簡単な使い方 判定したいクラスで BabyFace を include してちょっと設定書くだけです。 1
2
3
4
5
class &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoshiori.github.io/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="yoshiori.github.io" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">yoshiori.github.io</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoshiori.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/resume/">Resume</a></li>
  <li><a href="https://github.com/yoshiori">Github</a></li>
  <li><a href="http://d.hatena.ne.jp/Yoshiori">Hatena blog</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/09/babyface-gem/">BabyFace という Gem を作りました</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-09T00:00:00+09:00" pubdate data-updated="true">Dec 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>「<a href="http://ja.wikipedia.org/wiki/%E5%8D%98%E7%B4%94%E3%83%99%E3%82%A4%E3%82%BA%E5%88%86%E9%A1%9E%E5%99%A8">単純ベイズ分類器</a>」を簡単に組み込める gem を作ってみました！！</p>

<h1>BabyFace</h1>

<p><a href="https://github.com/yoshiori/baby_face">https://github.com/yoshiori/baby_face</a></p>

<h2>簡単な使い方</h2>

<p>判定したいクラスで BabyFace を include してちょっと設定書くだけです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Entry</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">BabyFace</span>
</span><span class='line'>  <span class="n">baby_face_for</span> <span class="ss">features</span><span class="p">:</span> <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">categories</span><span class="p">:</span> <span class="o">[</span><span class="ss">:ham</span><span class="p">,</span> <span class="ss">:spam</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>こんな形で指定します</p>

<ul>
<li>features

<ul>
<li>学習対象にする値</li>
</ul>
</li>
<li>categories

<ul>
<li>カテゴリ分け</li>
</ul>
</li>
</ul>


<p>が最小の設定になります。
これだけで、<code>Entry</code> のインスタンスに <code>baby_face</code> というのが生えます。
で、<code>categories</code> を元に学習用と判定用のメソッドが生えます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">entry1</span><span class="o">.</span><span class="n">baby_face</span><span class="o">.</span><span class="n">train_ham</span> <span class="c1"># ham を学習</span>
</span><span class='line'><span class="n">entry2</span><span class="o">.</span><span class="n">baby_face</span><span class="o">.</span><span class="n">train_spam</span> <span class="c1"># spam を学習</span>
</span><span class='line'>
</span><span class='line'><span class="n">entry3</span><span class="o">.</span><span class="n">baby_face</span><span class="o">.</span><span class="n">ham?</span> <span class="c1"># ham かどうか判定</span>
</span><span class='line'><span class="n">entry3</span><span class="o">.</span><span class="n">baby_face</span><span class="o">.</span><span class="n">spam?</span> <span class="c1"># spam かどうか判定</span>
</span></code></pre></td></tr></table></div></figure>


<p>こんな感じで特に難しいこと考えないで使えます。</p>

<h2>もうちょっとカスタマイズ</h2>

<h3>学習データの保存</h3>

<p>学習データはそのままだとメモリ上にあり保存されないので保存できるようにしてあります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">BabyFace</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;/tmp/baby_face&quot;</span>
</span><span class='line'><span class="n">entry</span><span class="o">.</span><span class="n">baby_face</span><span class="o">.</span><span class="n">save</span> <span class="c1"># =&gt; /tmp/baby_face/entry.babyface</span>
</span></code></pre></td></tr></table></div></figure>


<h3>文字列の分解方法</h3>

<p>デフォルトでは <code>String#split</code> していますが、カスタマイズできます</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;mecab&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;baby_face&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">wakachi</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@wakachi</span> <span class="o">||=</span> <span class="ss">MeCab</span><span class="p">:</span><span class="ss">:Tagger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;-O wakati&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@wakachi</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">split</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Entry</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">BabyFace</span>
</span><span class='line'>  <span class="n">baby_face_for</span> <span class="ss">features</span><span class="p">:</span> <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">categories</span><span class="p">:</span> <span class="o">[</span><span class="ss">:light_side</span><span class="p">,</span> <span class="ss">:dark_side</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">tokenizer</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">{</span> <span class="n">wakachi</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>みたいな感じで渡せます。
MeCab とか使って日本語を分かち書きする処理などを渡したり出来ます。</p>

<h3>ネストしたオブジェクト</h3>

<p>ActiveRecord の関連みたいなのも学習対象にすることが出来ます。
関連先でも <code>include</code> して <code>features</code> だけ書いていたらそれも使われます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Entry</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:comments</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">BabyFace</span>
</span><span class='line'>  <span class="n">baby_face_for</span> <span class="ss">features</span><span class="p">:</span> <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:comments</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">categories</span><span class="p">:</span> <span class="o">[</span><span class="ss">:ham</span><span class="p">,</span> <span class="ss">:spam</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">BabyFace</span>
</span><span class='line'>  <span class="n">baby_face_for</span> <span class="ss">features</span><span class="p">:</span> <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:message</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>学習データ詳細</h3>

<p>BabyFace はフィールドごとに単語を別扱いしています。
なので、上記の例で言えば <code>title</code> に入っている「殺す」と <code>body</code> に入っている「殺す」は別扱いしています。</p>

<h1>まとめ</h1>

<p>機械学習とかその辺のことは全然分かってないのですが、覚えるためにとりあえず自分で触ってみました。
さくっと組み込めるので投稿系のサービス作ってみるときとかに気軽に導入したり出来ると思います。
あと、自分のブログとはてブ数とか学習させて今から投稿する記事がはてブ稼げるかどうかとか見てみるのも楽しいかも。</p>

<p>まだ作ったばかりで色々足りないと思いますが、使ってみてください＞＜</p>

<p><a href="https://rubygems.org/gems/baby_face">https://rubygems.org/gems/baby_face</a></p>

<h1>そして名前の由来</h1>

<p>突然だけどスタンド使いとプログラマは似ていると思う。
自分から生み出したものが動作し世の中に影響を与える……
スタンドとはプログラムのことかもしれない。
そしてそんなプログラムを書ける人間はスタンド使いなのかもしれない。</p>

<p>だからプログラマ同士は惹かれ合うのかもしれない……</p>

<p>僕の大好きな第五部に「ベイビィ・フェイス」というちょっと変わったスタンドが出てきます。</p>

<blockquote><p>追跡するターゲットの遺伝子情報をノートパソコン型のスタンドへ入力、それを母体となる女性に受胎させることで、遠隔パワー型のスタンドを生み出す能力。</p></blockquote>

<p>という能力。</p>

<p>さらに作品中ではドンドン色々なことを学習させていくという感じです。</p>

<p><img src="https://github-camo.global.ssl.fastly.net/c2c5476da60f6af5321c1258c118c031c0b210a8/687474703a2f2f6661726d332e737461746963666c69636b722e636f6d2f323833352f31313137323639363539335f326539386439383164305f6f2e6a7067" alt="" /></p>

<p>コレって完全に教師あり学習だなぁと思ってたので今回の gem にこの名前をつけました。</p>

<p>実は人生初の ruby-gem です。</p>

<p>そして調べてたら「<a href="http://dic.nicovideo.jp/a/%E3%83%87%E3%82%A3%E3%83%BB%E3%83%A2%E3%83%BC%E3%83%AB%E3%83%88">しかし、このディ・モールトの使い方はイタリア語としてはディ・モールト間違っている。</a>」とかでてきてちょっとショックでしたが僕は元気です。</p>

<p>と、いうわけで実は「<a href="http://www.adventar.org/calendars/122">ジョジョの奇妙な冒険 Advent Calendar 2013</a>」の参加エントリでした。</p>

<blockquote><p>やっぱりプログラマなんだからプログラムで語らないとね!!</p></blockquote>

<p>と言うとかっこいいけど、実は普通に便乗して自分の gem の宣伝しただけですねｗｗ</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/11/0-dot-999999-equals-1/">小学生でもわかる計算だけで 0.9999…… が 1 な事を説明</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-11T21:29:00+09:00" pubdate data-updated="true">Oct 11<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近、学のない僕は定期的に会社で <a href="https://twitter.com/mrkn">@mrkn</a> と <a href="https://twitter.com/conceal_rs/">@conceal_rs</a> に数学を教わっています。</p>

<p>今日も教わっていたんだけどそこで、小学生で習ったことくらいしか使わないで <script type="math/tex"> 0.9999\ldots </script> が <script type="math/tex"> 1 </script> なことを証明できちゃったことに感動した。</p>

<h2>ということで説明</h2>

<p>最初の第一歩で小数点の循環して続いているところだけとりだす</p>

<script type="math/tex; mode=display">
  0.9999\ldots - 0.0999\ldots = 0.9
</script>


<p>で、次に <script type="math/tex"> 0.9999\ldots </script> を <script type="math/tex"> x </script>  に置き換えると</p>

<script type="math/tex; mode=display">
  x - x \div 10 = 0.9\\
  \Downarrow\\
  x - \frac{x}{10} = 0.9\\
  \Downarrow\\
  10x - x = 9\\
  \Downarrow\\
  9x = 9\\
  \Downarrow\\
  x = \frac{9}{9}\\
  \Downarrow\\
  x = 1\\
</script>


<p>で、さっき <script type="math/tex"> 0.9999\ldots </script> を <script type="math/tex"> x </script> にしたので戻すと</p>

<script type="math/tex; mode=display">
  0.9999\ldots = 1\\
</script>


<p>出来た！！！</p>

<p>すごいね！！</p>

<p>あと、<code>MathJax</code> というか <code>LaTeX</code> 難しい＞＜</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/10/langbook/">「コーディングを支える技術」読み終わってました</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-10T00:41:00+09:00" pubdate data-updated="true">Aug 10<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=F8F8F8&IS2=1&bg1=F8F8F8&fc1=000000&lc1=0000FF&t=yoshiori-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=477415654X" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>メール読み返したら</p>

<blockquote><p>「本送るから今の住所教えて！！」</p></blockquote>

<p>って言われた時に</p>

<blockquote><p>「書評書くの遅れて 5 月くらいになっちゃうよ」</p></blockquote>

<p>って答えてました。
<strong>時の流れって怖いですね！！</strong>
ヨシオリです。</p>

<p>本当にごめん＞＜</p>

<p>実は RailsConf の帰りの飛行機の中で読み終わってたんだけど、感想書くの延び延びになっちゃってた＞＜</p>

<h2>で、感想</h2>

<p>西尾さんの前に書いた<a href="http://www.amazon.co.jp/gp/product/4839922829/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4839922829&linkCode=as2&tag=yoshiori-22">Jythonプログラミング</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=yoshiori-22&l=as2&o=9&a=4839922829" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />の時に</p>

<blockquote><p>クラス使わないでクラス的なことを表現するのが一番面白かった。
そっち系のもっと読みたいなぁ</p></blockquote>

<p>って思ってたんだけど、まさにそんな本がでて凄く楽しく読みました。</p>

<p>プログラミングとか新しいことを勉強しようとしたら
「<strong>なんでそうなっているのか思想を学ぶ</strong>」
のが良いと思うんだけど、その<strong>思想</strong>が生まれた<strong>歴史</strong>まで学べたら更に良いよねって事でそんなのがいっぱい詰まっている本です。</p>

<p>例えば<em>第 3 章</em>で<strong>文法の誕生</strong>から始まって、<em>第 4 章</em>で<code>if</code>文を<code>GOTO</code>で表すところから始まり、<code>while</code>、<code>for</code> への説明へ続いていきます。</p>

<p>その後もそんな感じで全開で成り立ちから学んでいきます。
だってまさか「型」の説明の導入が「ランプのオンオフで数字を表してみよう」から始まるとは普通思わないよね！！
そこから固定小数点、浮動小数点の話に入っていって……みたいな感じで</p>

<p>他にもエラー処理の仕組みとか動的スコープと静的スコープの話とか並行処理の話とか……
なんというかプログラムやってる人がハマったり難しいと感じがちな部分が成り立ちから丁寧に説明されてて</p>

<blockquote><p>あぁ、俺がプログラミングやりはじてた頃にこの本があったらどんだけ良かったか……</p></blockquote>

<p>って思いながら読みました。</p>

<p>どれかのプログラミング言語に依存してたりしないでプログラミング言語について学べるので
プログラマはみんな読むと良いと思うよ！！</p>

<p>p.s.
そしてこういう話を飲みながらダラダラと話すのが一番面白かったりするので是非誘って下しあ＞＜</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/01/presentation-in-railsconf-2013/">RailsConf 2013 で LT してきました！！</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-01T19:19:00+09:00" pubdate data-updated="true">May 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>RailsConf 2013 がポートランドで開催されたので行って来ました！！
初の海外カンファレンス参加です！！</p>

<p>英語とか全然出来ないので必死に勉強していったのですが、やはり付け焼刃ではなかなか難しかったです＞＜</p>

<p>で、まぁ、出来ないからといって挑戦しないことには何も成長しないので LT に応募して発表して来ました。</p>

<object type="application/x-shockwave-flash" height="300" width="400" id="clip_embed_player_flash" data="http://www-cdn.justin.tv/widgets/archive_embed_player.swf" bgcolor="#000000"><param name="movie" value="http://www-cdn.justin.tv/widgets/archive_embed_player.swf" /><param name="allowScriptAccess" value="always" /><param name="allowNetworking" value="all" /><param name="allowFullScreen" value="true" /><param name="flashvars" value="auto_play=false&start_volume=25&title=Title&channel=confreaks&chapter_id=2250576" /></object>


<br /><a href="http://www.justin.tv/confreaks#r=-rid-&amp;s=em" class="trk" style="padding: 2px 0px 4px; display: block; width: 320px; font-weight: normal; font-size: 10px; text-decoration: underline; text-align: center;">Watch live video from Confreaks - Live Streaming on Justin.tv</a>


<p>マジ今聞き直しても背中の汗が止まらない酷い英語ですね＞＜</p>

<p>でも、皆さん優しくて終わった後、暖かい声を頂きました</p>

<blockquote><p>@yoshiori amazing talk :) #railsconf</p><footer><strong>@senthilnayagam</strong> <cite><a href='https://twitter.com/senthilnayagam/status/329768448601239554'>twitter.com/senthilnayagam/&hellip;</a></cite></footer></blockquote>




<blockquote><p>Ladies and gentlemen, @yoshiori is a bad ass developer. That last lightening talk was killer. #railsconf</p><footer><strong>@davidcmolina</strong> <cite><a href='https://twitter.com/davidcmolina/status/329768905306406912'>twitter.com/davidcmolina/status/&hellip;</a></cite></footer></blockquote>




<blockquote><p>Hillarious! Well done! Love the dialog style presentation! @yoshiori #railsconf  // Thanks for the correction, @tmaesaka!</p><footer><strong>@crueber</strong> <cite><a href='https://twitter.com/crueber/status/329769643977871360'>twitter.com/crueber/status/&hellip;</a></cite></footer></blockquote>




<blockquote><p>@yoshiori @a_matsuda hey rubygems-mirror-command looks great. @raggi and @markimbriaco had a way to download the all the gems in a few mins!</p><footer><strong>@qrush</strong> <cite><a href='https://twitter.com/qrush/status/329770309089644544'>twitter.com/qrush/status/&hellip;</a></cite></footer></blockquote>




<blockquote><p>@yoshiori Your lightning talk was awesome. How did you make the slides?</p><footer><strong>@ckrailo</strong> <cite><a href='https://twitter.com/ckrailo/status/330031270493032448'>twitter.com/ckrailo/status/&hellip;</a></cite></footer></blockquote>


<p>とりあえず資料公開しておきます。</p>

<script async class="speakerdeck-embed" data-id="d1c1311094f80130298d2efa0068aa13" data-ratio="1.2896725440806" src="//speakerdeck.com/assets/embed.js"></script>


<p>英語の文章を書くときに色々相談に乗ってくれた</p>

<p><a href="https://twitter.com/mrkn">@mrkn</a>,<a href="https://twitter.com/tmaesaka">@tmaesaka</a>,<a href="https://twitter.com/adorechic">@adorechic</a>,<a href="https://twitter.com/r7kamura">@r7kamura</a> 本当にありがとう！！</p>

<p>そして丁度 RailsConf に参加している期間で試用期間が終わり COOKPAD の正式な一員になりました。
試用期間にもかかわらず RailsConf に参加させていただいた会社にも大感謝です。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/22/add-support-none-to-chankos-active-if/">Chanko の Active_if で None を使えるようにしました</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-22T23:21:00+09:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><code>Chanko</code> の <code>active_if</code> は今まで <code>all</code>, <code>any</code> 相当の機能しかなかったのですが、<code>none</code> の機能を追加しました。
（コード的にはいつでも <code>one?</code> 相当の機能も実装できるのですが、必要性を感じなかったので……）</p>

<p><a href="https://github.com/cookpad/chanko/pull/31">Add Support &#39;none&#39; to active_if by yoshiori · Pull Request #31 · cookpad/chanko</a></p>

<p>これにより例えば特定のデバイスに向けた機能と特定のデバイスを弾きたい機能があった場合に今までは</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ActiveIf</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="ss">:device_hoge?</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
</span><span class='line'><span class="no">ActiveIf</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="ss">:not_device_hoge?</span><span class="p">)</span> <span class="p">{</span> <span class="o">!.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>と別々に定義しておいて</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">active_if</span> <span class="ss">:all_staffs?</span><span class="p">,</span> <span class="ss">:device_hoge?</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">active_if</span> <span class="ss">:all_staffs?</span><span class="p">,</span> <span class="ss">:not_device_hoge?</span>
</span></code></pre></td></tr></table></div></figure>


<p>それぞれ書いていました。
（<code>active_if</code> はデフォルトは <code>all</code> になります）</p>

<p>これを <code>none</code> を使うと</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ActiveIf</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="ss">:device_hoge?</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>と定義しておいて</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">active_if</span> <span class="ss">:all_staffs?</span><span class="p">,</span> <span class="ss">:device_hoge?</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">active_if</span> <span class="ss">:all_staffs?</span><span class="p">,</span> <span class="n">none</span><span class="p">(</span><span class="ss">:device_hoge?</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>と書くことが出来るようになりました。</p>

<p>また、入れ子もサポートしていますので</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">active_if</span> <span class="ss">:all_staffs?</span><span class="p">,</span> <span class="n">any</span><span class="p">(</span><span class="n">none</span><span class="p">(</span><span class="ss">:device_hoge?</span><span class="p">),</span> <span class="n">none</span><span class="p">(</span><span class="ss">:device_bar?</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>のような事も書けます。</p>

<p>ちなみにこの機能を書くときに似た処理である <code>any</code> と <code>none</code> を統合した結果、<code>any</code> も入れ子をサポートするようになったので</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">active_if</span> <span class="n">any</span><span class="p">(</span><span class="n">any</span><span class="p">(</span><span class="n">any</span><span class="p">(</span><span class="n">none</span><span class="p">(</span><span class="ss">:false</span><span class="p">,</span> <span class="ss">:false</span><span class="p">),</span> <span class="ss">:false</span><span class="p">),</span> <span class="ss">:false</span><span class="p">),</span> <span class="ss">:false</span><span class="p">)</span>
</span><span class='line'><span class="c1"># true</span>
</span></code></pre></td></tr></table></div></figure>


<p>というようなモノもサポートするようになりました。</p>

<p>（実際にやるのは推奨しませんがｗｗｗ）</p>

<p>ということで、自分のコードが取り込まれたのが嬉しくて久しぶりにブログを書いてみました。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/17/devsum-2013/">デブサミ 2013 で自分戦略について発表して来ました</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-17T20:22:00+09:00" pubdate data-updated="true">Feb 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今年も（！？）ギリギリオファーがありデブサミで発表して来ました。</p>

<script async class="speakerdeck-embed" data-id="4c4519c059860130d1bf1231392d87a1" data-ratio="1.2896725440806" src="//speakerdeck.com/assets/embed.js"></script>


<p>なんというか高卒 &amp;&amp; 25 歳からプログラマになったという二重苦みたいな環境なので
大卒の人とかもっと若い頃からプログラム書いてた人は僕よりは楽に進めると思いますが、最低限こんなもんだよねって言うのを見てもらえればいいと思います。</p>

<h2>口頭で説明した部分をざっくり書くと</h2>

<ol>
<li>25歳からプログラマになった</li>
<li>組み込み系、SI を経て web系へ転職</li>
<li>プログラマからプレイングマネージャになった</li>
<li><p>自分戦略として考える軸として、</p>

<ul>
<li>お金（自分の市場価値）</li>
<li>純粋に好奇心から自分のスキルを上げたい</li>
</ul>


<p>の 2 つを考えると考えやすいと思います。</p></li>
<li><p>（僕の戦略として）目指すところは最強</p></li>
<li>ドラクエで言うとお金貯めるよりステータス上げたい</li>
<li>リーダーとしてそれなりにやれることは確認できた</li>
<li>次のステップとしてはやはり自分の根っこはエンジニアなのでエンジニアとしてまたガッツリ LV を上げたい</li>
<li>Java で一番の下手くそになれる会社は日本にはあんまりなさそうだなぁ</li>
<li>言語も文化も変えたい(Java での伸び代よりも他の言語をガッツリやったほうが伸び代が有る)</li>
<li>自分が尊敬できるエンジニアが一番集まっていて、かつ自分が一番の下手くそになれる会社を探した</li>
<li>実際にコード書くとこんなにツッコミが！！！</li>
<li>というわけで、ガッツリレベル上げたい人！！ <a href="https://www.wantedly.com/projects/2">一緒に働きましょう！！</a></li>
</ol>


<p>という感じです。</p>

<h2>ついでに言っておくと</h2>

<p>なんかブームみたいになっていたせいか「退職ブログは書かないの？」と聞かれるんだけど、
俺は別れた女について聞かれても「俺にはもったいないくらい、いい女だったよ」以外の答えを持ってねーよ！！</p>

<p>もうちょっと言うと、退職ブログを書く人を別に否定はしないけど、俺としては公に書けるようなことは何もないし
上っ面のこと適当にでっち上げて書けるほど器用じゃないよって事です。</p>

<p>どうしても知りたかったら焼肉でもおごってください。
そこまで知りたい人には話しますよっと。</p>

<h2>というわけで COOKPAD で働いています</h2>

<p>いちエンジニアとして初めての言語、初めてのフレームワークという環境でガッツリ頑張っています！！
マジで楽しいので是非一緒に働きましょう！！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/10/sql-antipatterns/">「SQL アンチパターン」は色んな戦争の火種になりそう</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-10T22:29:00+09:00" pubdate data-updated="true">Feb 10<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yoshiori-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4873115892" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>監訳の一人である @t_wada に献本頂きました。
ありがとうございます！！！</p>

<p>でだ、いきなりだけどコレ、タイトルで損してると思うんだよね……</p>

<p>だって、<code>SQL</code> のアンチパターンてタイトルだったら、</p>

<blockquote><p><code>join</code> した結果の方で <code>where</code> で絞るよりも <code>on</code> 句で先に絞れ</p></blockquote>

<p>的なのが書いてあると思うじゃん！！
問い合わせ言語の事だと思うじゃん！！！</p>

<p><strong>違った……</strong></p>

<p>ほとんど書いてあるのは DB 設計についてだった……
まぁ、副題は「Avoiding the Pitfalls of Database Programming」のだし、まぁいいか。</p>

<h1>んで、読んでみた感想とか</h1>

<p>もうね、何年か DB 絡んだ開発したことのある人なら（・∀・）ﾆﾔﾆﾔ出来ると思う。</p>

<blockquote><p>「&#8221;マルチカラムアトリビュート&#8221;とか 10 年前に通ったわー」</p></blockquote>

<p>とか</p>

<blockquote><p>「あーはいはい&#8221;インデックスショットガン&#8221;乙」</p></blockquote>

<p>みたいな。</p>

<blockquote><p>Explain の結果も見ないでインデックス貼りまくる奴いるよねーーー</p></blockquote>

<p>とか、ドンドン盛り上がれそう。</p>

<p>実際俺も&#8221;EAV（エンティティ・アトリビュート・バリュー）&#8221; はホントつい最近もやろうと思った。
(結局複雑になりすぎるからやめたけど)</p>

<h2>個人的に反対なアンチパターン</h2>

<h3>ファントムファイル</h3>

<p>ファントムファイルの解決策については実際に 2 度やったことがある。
データの規模も、ユーザーの想定数もぜんぜん違う 2 つのアプリで……
でもそのファイルへのアクセス方法とか逆に複雑になるだけで何も得しなかった。
よく考えればファイルシステムそのものがファイルを扱うことに特化した KVS 的なものなんだからそっち使ったほうが良いというのが俺のプラクティスだなぁ</p>

<h2>反対では無いけどあんまり賛同しないアンチパターン</h2>

<h3>キーレスエントリ</h3>

<p>外部キー制約で、</p>

<blockquote><p>オーバーヘッド、……にはなりません</p></blockquote>

<p>って書いてあるんだけど、いやなるでしょ……
どの程度の更新頻度を見ているのかわからないけど、ソーシャルゲーム系とか外部キー制約とか貼ってたら無理な気がするんだけどどうなんだろう？</p>

<p>ここは本当にこの文章を鵜呑みにしないで、設計時にちゃんと想定ユーザー数で負荷テストやらないと怖いことになりそう……</p>

<h1>で、この本の本当に凄いところはパターンに名前を付けたこと</h1>

<p>さて、ここまで読んでもらえばわかると思うんだけど、この本の本当に凄いところは <strong>パターンに名前を付けたこと</strong> だと思う。</p>

<p>俺が書いたみたいに例えば「ファントムファイルは俺は反対だな」的な事が簡潔に言えるようなことになったのは本当に素晴らしいと思う。
今までだったら「ファイルをさ、DB にデータとしていれるパターンあるじゃん！！いや、パスじゃなくてデータ自体をだよ！！ ほら、入れておくとカラムのデータとの整合性を保つのが楽だとか……
」とかそんな説明をしてからじゃあ無いと議論が始められなかったのがサクッと始められるようになった。</p>

<p>というわけで、タイトルに書いたとおり戦争の火種になってくれそうな本だなぁと。
逆に今までは何度か DB 設計したことないとこういう議論が出来なかったのが本にまとまってくれたのでこれで誰でも議論に参加できるね！！！</p>

<h3>p.s.</h3>

<p>付録の 第 4 正規形とかの例が凄く良かったです！！（個人的に不得手な所だったので）</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/03/factory-girl-relation/">【解決済み】FactoryGirl の Relation の定義の仕方がよくわからない＞＜</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-03T22:09:00+09:00" pubdate data-updated="true">Feb 3<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>FactoryGirl で relation 定義したいんだけど、具体的には</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:tasks</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Task</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:user</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>こんな 2 つのモデルで</p>

<figure class='code'><figcaption><span>users.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">tasks</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">[</span>
</span><span class='line'>       <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:task</span><span class="p">)</span> <span class="p">,</span>
</span><span class='line'>      <span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>tasks.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:task</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>みたいな定義をしておくと……</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="no">Failure</span><span class="o">/</span><span class="ss">Error</span><span class="p">:</span> <span class="no">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">matching</span> <span class="n">line</span> <span class="n">from</span> <span class="n">backtrace</span>
</span><span class='line'> <span class="ss">SystemStackError</span><span class="p">:</span>
</span><span class='line'>     <span class="n">stack</span> <span class="n">level</span> <span class="n">too</span> <span class="n">deep</span>
</span></code></pre></td></tr></table></div></figure>


<p>まぁ、メッセージの通り循環参照になっちゃうからダメなのは分かる。</p>

<p>でも、<code>:user</code> の宣言から <code>tasks</code> 外すと</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span>
</span></code></pre></td></tr></table></div></figure>


<p>で何も返ってこないし、逆に <code>:task</code> の方で <code>user</code> 外すと
今度は <code>presence</code> のバリデーションに引っかかっちゃう</p>

<p>絶対書き方間違えてるせいなんだけど、どうやったらいいのかわからない＞＜
教えてエロイ人！！！！</p>

<p>追記</p>

<blockquote><p>@yoshiori こんな感じでどうでしょうか https://t.co/ScRDRvLK</p><footer><strong>@naoty_k</strong> <cite><a href='https://twitter.com/naoty_k/status/298061407499468801'>twitter.com/naoty_k/status/&hellip;</a></cite></footer></blockquote>


<p>と教えてもらいました</p>

<blockquote><p>@yoshiori すいません、さっきのは循環しそうなので、修正しました。 https://t.co/ScRDRvLK</p><footer><strong>@naoty_k</strong> <cite><a href='https://twitter.com/naoty_k/status/298062728004788224'>twitter.com/naoty_k/status/&hellip;</a></cite></footer></blockquote>


<p>とのことでしたが僕の手元では <code>trait</code> 使わなくても行けました！！！
ありがとうございます！！！</p>

<p>他にも</p>

<blockquote><p>@yoshiori こうでどうだろうか http://t.co/Sf1oc9OV</p><footer><strong>@rosylilly</strong> <cite><a href='https://twitter.com/rosylilly/status/298062237988442114'>twitter.com/rosylilly/status/&hellip;</a></cite></footer></blockquote>




<blockquote><p>@yoshiori userの定義に、after :create do … end でtasksを追加するとよさそうー</p><footer><strong>@tomoya55</strong> <cite><a href='https://twitter.com/tomoya55/status/298064513360605184'>twitter.com/tomoya55/status/&hellip;</a></cite></footer></blockquote>


<p>といろいろな方が教えてくれました！！！
ありがとうございます！！！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/31/file-update-emacs/">Git で Branch 切り替えた時とかに Emacs で開いてるファイルの Buffer を更新</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-31T16:14:00+09:00" pubdate data-updated="true">Jan 31<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Git で作業してると branch 切り替えたり stash したり色々と emacs の buffer で開いてるファイルが裏で更新されることが増えた。
で、気づかずにセーブしようとして確認でて上書きすると裏であった変更消しちゃうし開き直すと今書いたの消えちゃうしとか……</p>

<p>なんかそういう設定有るはずだよなぁとか思いながら見つけられてなかったんだけど、やっと見つけた。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="c1">;; 変更のあったファイルの自動再読み込み</span>
</span><span class='line'><span class="p">(</span><span class="nv">global-auto-revert-mode</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>これで安心！！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/30/use-pluck-uniq/">ActiveRecord::Relation#pluck 使うときは Array が返ってくるの忘れちゃいけない</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-30T20:38:00+09:00" pubdate data-updated="true">Jan 30<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>元々こんなコードがあった</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:tag</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span>
</span></code></pre></td></tr></table></div></figure>


<p>で、title しか使ってないんだからいちいち ActiveRecode のオブジェクト作って取り出すより pluck 使うように修正した</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:tag</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pluck</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span>
</span></code></pre></td></tr></table></div></figure>


<p>そう、俺はここで満足してしまった……で、pull request 出した結果突っ込まれ。</p>

<blockquote><p>uniq を前に持って来い</p></blockquote>

<p>ActiveRecord::Relation の uniq は DISTINCT を付けてくれるので DB 側で処理される。
ところが pluck は Array が返ってくるので Array#uniq になってしまう。</p>

<p>実際に実行してみると</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">014</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:tag</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pluck</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">3</span><span class="o">.</span><span class="mi">4</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="n">title</span> <span class="no">FROM</span> <span class="s2">&quot;posts&quot;</span> <span class="no">WHERE</span> <span class="s2">&quot;posts&quot;</span><span class="o">.</span><span class="s2">&quot;tag&quot;</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;title1&quot;</span><span class="p">,</span> <span class="s2">&quot;title2&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">015</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:tag</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">pluck</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">5</span><span class="o">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">DISTINCT</span> <span class="n">title</span> <span class="no">FROM</span> <span class="s2">&quot;posts&quot;</span> <span class="no">WHERE</span> <span class="s2">&quot;posts&quot;</span><span class="o">.</span><span class="s2">&quot;tag&quot;</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;title1&quot;</span><span class="p">,</span> <span class="s2">&quot;title2&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>もちろん結果は同じだけど DB で処理できることは DB に任せたほうがいいよね。
件数増えると結構差が出ると思う。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/09/20/released-open-emacs/">21 世紀のエディタである Atom を最強にする</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/18/twitter-stream-to-amazon-kinesis/">Twitter の Timeline を Amazon Kinesis に流すの作った</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/10/released-scorekeeper/">気軽なポジティブ・フィードバック好き</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/22/pomodoro-timer-for-atom/">Pomodoro Timer の Atom Package 作った！</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/15/my-friend/">友人の山城が死んだ</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/yoshiori">@yoshiori</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'yoshiori',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="well">
  <h1>Coderwall Badges</h1>
  <div id="coderwall_badges"></div>
  <a href="http://coderwall.com/yoshiori">@yoshiori</a> on coderwall
  <script type="text/javascript">
    $(function(){
      $.ajax({
        url: "https://coderwall.com/yoshiori.json"
        , dataType: 'jsonp'
        , success: function(data) {
          for(var i = 0; i < data.data.badges.length ; i++){
            var badge = data.data.badges[i];
            var badge_tag = $("<img />");
            badge_tag.attr("src",badge.badge);
            badge_tag.css("width","33%");
            $("#coderwall_badges").append(badge_tag);
          }
        }
      });
    });
  </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <a class="twitter-timeline" href="https://twitter.com/yoshiori" data-widget-id="365845268207386624">@yoshiori からのツイート</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Yoshiori SHOJI -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'yoshiorigithubblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
